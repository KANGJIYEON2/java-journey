package day4;

public class IfBitwiseExample {
    public static void main(String[] args) {
        // 플래그(Flags)란?
        // 상태를 나타내는 깃발 같은 것.
        // 여러 상태를 하나의 int 값의 비트로 표현해서 관리.
        // 메모리/속도 최적화 + 복잡한 상태를 한방에 관리하기 위해서 플래그를 씀.
        // 예: flags = 0b10110101
        // 7 6 5 4 3 2 1 0   (비트 위치)
        // 1 0 1 1 0 1 0 1
        // 이진수로 8가지 상태(플래그)를 하나의 숫자로 관리.

        int flags = 0b10110101; //2진수 리터럴 ob => 컴파일러가 2진수를 인식할 수 있도록 표기

        int errorCode = 23; // 예시 에러 코드

        // 플래그 체크 1: 마지막 비트(0번째)가 1이면 관리자 플래그가 켜져있음
        boolean isAdmin = (flags & 0b00000001) != 0;

        // 플래그 체크 2: 3번째 비트(2번째 자리)가 1이면 수정 권한 플래그
        boolean canEdit = (flags & 0b00000100) != 0;

        // -------------------------------
        // (1) 관리자이면서 + 5번째 비트(16)가 켜져있음
        // (2) 아니면, 관리자가 아닌데 + 수정 가능 + 에러코드<50일 때 8번째 비트(128)가 켜져있음
        if ((isAdmin && (flags & 0b00010000) != 0) ||
                (!isAdmin && canEdit && (errorCode < 50 ? (flags & 0b10000000) != 0 : false))) {

            System.out.println("편집 가능: 복잡 조건 통과");

            // -------------------------------
            // else if : errorCode의 마지막 4비트만 따져서, 7과 같은지 확인
            // 0x0F = 0000 1111 => 마지막 4비트만 남기기 위한 마스크
            // 즉 errorCode & 0x0F 이 7이면 특별 처리
        } else if ((errorCode & 0x0F) == 7) {
            System.out.println("특수 에러코드 7 처리 루틴");

        } else {
            System.out.println("권한 또는 조건 불충족");
        }

        // -------------------------------
        // 삼항 연산자로 플래그 조건에 따라 상태 문자열 결정
        String result = (isAdmin ?
                // 관리자라면: 7번째 비트(64)가 켜져있으면 슈퍼관리자, 아니면 일반관리자
                ((flags & 0b01000000) != 0 ? "슈퍼관리자" : "일반관리자") :
                // 관리자가 아니면: 수정 가능 + 에러코드 짝수 -> 수정가능사용자, 아니면 읽기전용
                ((canEdit && (errorCode % 2 == 0)) ? "수정가능사용자" : "읽기전용사용자"));

        System.out.println("최종 권한 분류: " + result);
    }
}

// 주의! flags 같은 권한 정보를 토큰이나 데이터에 넣을때 반.드.시 해시(또는 서명) 범위에 포함해야됨.
// 관리자 여부 따지는거만 flags 비트로 따로 저장하는 경우도 많은데 이런 절대 안 된 다!!! 그렇지 않으면 진짜로 flags |= 0b1 같은 값으로 관리자 페이지 접속할수도....